#!/bin/bash

set -x
set -e

source /common.sh

mkdir -p /sketch_template/kaithem/

unpack /filesystem/KaithemAutomation/kaithem/var /sketch_template/kaithem root

unpack /filesystem/KaithemAutomation /sketch_template/kaithem_install/ root
unpack /filesystem/systemd/ /usr/lib/systemd/system/ root
unpack /filesystem/kaithem_sketch /sketch_template/kaithem root

#Remove dummy keys so the user can add them if missing
! rm /sketch_template/kaithem/ssl/certificate.key
! rm /sketch_template/kaithem/ssl/certificate.cert

systemctl enable kaithem.service

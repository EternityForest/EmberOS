#!/bin/bash

set -x
set -e

apt -y install mosquitto
echo "persistence false" > /etc/mosquitto/conf.d/emberos.conf
systemctl enable mosquitto



#Also gets firewalld
# apt -y install firewall-config

apt -y install python3-smbus

#Batteries included, allow messing with kiosk browser media right from the device
apt -y install gimp audacity tuxpaint
apt -y install transmission-cli 
apt -y install xclip zenmap

apt -y install sqlitebrowser

#Always good to have around
apt -y install gnome-disk-utility

apt -y install unclutter
apt -y install imagemagick


apt -y install fvwm fvwm-icons

update-icon-caches /usr/share/icons/*

# Installs the Micro editor
# Do this early, it can't be cached like apt
cd /usr/bin/
curl https://getmic.ro | bash

#Useful for testing
apt -y install x11-apps




apt -y install python3

apt -y install exfat-utils
apt -y install python3-setproctitle
apt -y install python3-cffi

pip3 install yappi
pip3 install msgpack
pip3 install paho-mqtt
pip3 install smbus
pip3 install automationhat


mkdir -p /publictemp
mkdir -p /sketch/public.www/
mkdir -p /sketch/public.files/

echo "Welcome! This file is /sketch/public.www/index.html. You can alt+f4 out to a graphical desktop."> /sketch/public.www/index.html

apt -y install apache2

mkdir -p /sketch/public.www

#Give www-data a "window into the root filesystem"
cat << EOF > /sketch/config/filesystem/www.yaml
/sketch/public.www:
    mode: '0750'
    user:  www-data
    bindat: /var/www/html
EOF

sudo apt-get install -y php-{bcmath,bz2,intl,gd,mbstring,mcrypt,mysql,zip}
apt-get install libapache2-mod-php -y
sudo systemctl enable apache2.service

apt -y install mpv
apt -y install python3 systemd cython3 build-essential
apt -y install mplayer python3-serial

apt -y install python3-tz python3-dateutil lm-sensors
apt -y install python3-netifaces python3-jack-client
apt -y install python3-gst-1.0 python3-libnacl jack-tools
apt -y install jackd2 gstreamer1.0-plugins-good gstreamer1.0-plugins-bad a2jmidid
apt -y install swh-plugins tap-plugins caps  gstreamer1.0-plugins-ugly python3-psutil
#Don't include a giant soundfont, kaithem already has a decent one
apt install -y --no-install-recommends  fluidsynth


apt install -y spacefm
apt install -y deluge
apt install -y ardour
apt install -y krita


apt -y install nmap robotfindskitten
apt -y install ncdu
apt -y install mc
apt -y install curl
apt -y install vim
apt -y install emacs
apt -y install xcas
apt -y install units
apt -y install git
apt -y install wget
apt -y install htop
apt -y install lsof
apt -y install fzf
apt -y install chafa
apt -y install nast



#Without this we have all kinds of issues doing startx
apt -y install xserver-xorg-legacy

#Allow non-console startx, needed to make kiosk browsing work
#This has to be AFTER the xserver-xorg-legacy to work
sed -i \
    's/allowed_users=console/allowed_users=anybody/' /etc/X11/Xwrapper.config

apt -y install fatrace


#Install last so the build doesn't try using it from inside quemu
#And slow everything down by not working
apt -y install squid-deb-proxy-client



apt -y autoremove
#!/bin/bash

usermod --shell /usr/bin/xonsh pi


rm -rf /tmp/*
rm -rf /var/tmp/*
rm -rf /var/log/*
apt-get -y reinstall shared-mime-info

#During image creation packages may have put stuff in the persist folder.
#Move it to the real sketch persist and delete it.
#Technically we coul;d mount the real one during setup but that is one more thing to go wrong.
rsync -avz /home/pi/persist /sketch/home/pi

rm -rf /home/pi/persist/**


#Restore Yarn settings
yarn config set cache-folder /usr/local/share/.cache/yarn



#This was like somehow getting undone?????
touch /etc/pipewire/media-session.d/with-jack
cp /usr/share/doc/pipewire/examples/ld.so.conf.d/pipewire-jack-*.conf /etc/ld.so.conf.d/
ldconfig

! rm /etc/machine-id


# Make unwritable till the mounts get there
chmod 555 /var/tmp
